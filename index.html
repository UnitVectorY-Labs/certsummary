<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>certsummary</title>
  <style>
    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      background-color: #f4f4f4;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a {
      color: #3b82f6;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .navbar {
      background-color: #3b82f6;
      color: #fff;
      padding: 15px 20px;
      display: flex;
      align-items: center;
    }
    main {
      flex: 1;
      display: flex;
      padding: 20px;
      gap: 20px;
    }
    .left, .right {
      background-color: #fff;
      padding: 25px;
      border-radius: 6px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .left {
      flex: 1;
      max-width: 600px;
    }
    .right {
      flex: 1.5;
      overflow-x: auto;
    }
    h1 {
      font-size: 1.5em;
      color: #2c3e50;
    }
    h2 {
      font-size: 1.2em;
      color: #2c3e50;
      margin-bottom: 15px;
    }
    /* File input styling */
    .cert-input-container {
      margin-bottom: 20px;
    }
    textarea {
      display: block;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      min-height: 500px;
      font-family: monospace;
      resize: vertical;
    }
    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    table td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    table td:first-child {
      font-weight: bold;
      width: 40%;
      vertical-align: top;
    }
    /* Footer Styles */
    footer {
      background-color: #2c3e50;
      color: #ecf0f1;
      font-size: 0.8em;
      padding: 1rem;
      border-top: 1px solid #e5e7eb;
      text-align: center;
    }
    footer a {
      color: #9ca3af;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <h1>certsummary</h1>
  </nav>

  <main>
    <section class="left">
      <h2>Paste PEM Certificate</h2>
      <div class="cert-input-container">
        <textarea id="cert-input" placeholder="Paste your PEM certificate here:&#10;-----BEGIN CERTIFICATE-----&#10;...&#10;-----END CERTIFICATE-----)"></textarea>
      </div>
    </section>

    <section class="right">
      <h2>Certificate Details</h2>
      <div id="output">
        <p>No certificate processed yet.</p>
      </div>
    </section>
  </main>

  <footer>
    <p>
      <a href="https://github.com/UnitVectorY-Labs">UnitVectorY Labs</a> | 
      <a href="https://opensource.org/licenses/MIT">MIT License</a> | 
      <a href="https://github.com/UnitVectorY-Labs/certsummary"><strong>certsummary</strong> on GitHub</a>
    </p>
  </footer>

  <!-- Load jsrsasign Library from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/11.1.0/jsrsasign-all-min.js" integrity="sha512-Eu9j+HZBor7muHf6IDWoWZ8FKVr6nKe9eIIVR28NEte4Y4GiYRlke26XGdR/re81XE/FfLoLYYVkvNk5GY9RvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // Helper: Format certificate dates to standard format (MMM DD HH:MM:SS YYYY GMT)
    function formatDate(certDateStr) {
        console.log(certDateStr);
      // Handle both UTCTime (YYMMDDhhmmssZ) and GeneralizedTime (YYYYMMDDhhmmssZ) formats
      if (!certDateStr || certDateStr.length < 13) return certDateStr;
      
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                      'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      let year, month, day, hour, minute, second;
      
      // Check if it's UTCTime format (YYMMDDhhmmssZ)
      if (certDateStr.length === 13 && certDateStr.endsWith('Z')) {
        const yearPrefix = parseInt(certDateStr.substring(0, 2), 10) >= 50 ? '19' : '20';
        year = yearPrefix + certDateStr.substring(0, 2);
        month = parseInt(certDateStr.substring(2, 4), 10) - 1; // 0-based month
        day = certDateStr.substring(4, 6);
        hour = certDateStr.substring(6, 8);
        minute = certDateStr.substring(8, 10);
        second = certDateStr.substring(10, 12);
      } 
      // GeneralizedTime format (YYYYMMDDhhmmssZ)
      else {
        year = certDateStr.substring(0, 4);
        month = parseInt(certDateStr.substring(4, 6), 10) - 1; // 0-based month
        day = certDateStr.substring(6, 8);
        hour = certDateStr.substring(8, 10);
        minute = certDateStr.substring(10, 12);
        second = certDateStr.substring(12, 14);
      }
      
      return `${months[month]} ${parseInt(day, 10)} ${hour}:${minute}:${second} ${year} GMT`;
    }

    // Helper: Extract CN from a distinguished name string
    function extractCN(distinguishedName) {
      if (!distinguishedName || typeof distinguishedName !== 'string') return "Unknown";
      var match = distinguishedName.match(/CN=([^\/]+)/);
      return match ? match[1].trim() : distinguishedName;
    }

    // Helper: Format Subject Alternative Names
    function formatSANs(sanArray) {
      if (!sanArray || !Array.isArray(sanArray.array)) return "N/A";
      
      try {
        // Create an unordered list for the SANs
        let sanList = "<ul style='margin: 0; padding-left: 20px;'>";
        
        // Loop through the SANs and add each as a list item
        for (let i = 0; i < sanArray.array.length; i++) {
          const san = sanArray.array[i];
          if (san.dns) {
            sanList += `<li>DNS: ${san.dns}</li>`;
          } else if (san.ip) {
            sanList += `<li>IP: ${san.ip}</li>`;
          } else if (san.email) {
            sanList += `<li>Email: ${san.email}</li>`;
          } else if (san.uri) {
            sanList += `<li>URI: ${san.uri}</li>`;
          } else {
            sanList += `<li>${JSON.stringify(san)}</li>`;
          }
        }
        
        sanList += "</ul>";
        return sanList;
      } catch (e) {
        console.error("Error formatting SANs:", e);
        return "Error formatting SANs";
      }
    }

    // Process certificate when text input changes
    document.getElementById('cert-input').addEventListener('input', function() {
      var certText = this.value.trim();
      if (certText && certText.indexOf('-----BEGIN CERTIFICATE-----') !== -1) {
        processCertificate(certText);
      }
    });

    function processCertificate(pem) {
      var output = document.getElementById('output');
      if (pem.indexOf('-----BEGIN CERTIFICATE-----') === -1) {
        output.innerHTML = '<p style="color:red;">Invalid certificate format.</p>';
        return;
      }
      try {
        var x509 = new X509();
        x509.readCertPEM(pem);

        // Identity Information
        var subjectStr = x509.getSubjectString(); // e.g., "/C=US/ST=California/CN=example.com"
        var primaryCN = extractCN(subjectStr);
        var sanExt = x509.getExtSubjectAltName(); // Returns array of objects with SANs
        var formattedSANs = formatSANs(sanExt);

        // Certificate Validation
        var issuerStr = x509.getIssuerString();
        var notBefore = x509.getNotBefore();
        var notAfter = x509.getNotAfter();
        var formattedNotBefore = formatDate(notBefore);
        var formattedNotAfter = formatDate(notAfter);

        // Fingerprints
        var certHex = x509.hex;
        var sha1Fingerprint = KJUR.crypto.Util.hashHex(certHex, "sha1");
        var sha256Fingerprint = KJUR.crypto.Util.hashHex(certHex, "sha256");
        var sha1Link = `<a href="https://crt.sh/?q=${sha1Fingerprint}" target="_blank">${sha1Fingerprint}</a>`;
        var sha256Link = `<a href="https://crt.sh/?q=${sha256Fingerprint}" target="_blank">${sha256Fingerprint}</a>`;

        // Security & Cryptographic Info
        var pubKey = x509.getPublicKey();
        var keyAlgorithm = pubKey.type ? pubKey.type : "Unknown";
        var signatureAlgorithm = x509.getSignatureAlgorithmField();

        // Build the details table (alternating row colors applied via CSS)
        var html = `
          <table>
            <tr>
              <td>Issuer</td>
              <td>${issuerStr}</td>
            </tr>
            <tr>
              <td>Subject</td>
              <td>${subjectStr}</td>
            </tr>
            <tr>
              <td>Valid From</td>
              <td>${formattedNotBefore}</td>
            </tr>
            <tr>
              <td>Valid To</td>
              <td>${formattedNotAfter}</td>
            </tr>
            <tr>
              <td>SHA-1 Fingerprint</td>
              <td>${sha1Link}</td>
            </tr>
            <tr>
              <td>SHA-256 Fingerprint</td>
              <td>${sha256Link}</td>
            </tr>
            <tr>
              <td>Key Algorithm</td>
              <td>${keyAlgorithm}</td>
            </tr>
            <tr>
              <td>Signature Algorithm</td>
              <td>${signatureAlgorithm}</td>
            </tr>
            <tr>
              <td>Primary Domain (CN)</td>
              <td>${primaryCN}</td>
            </tr>
            <tr>
              <td>Additional Domains (SANs)</td>
              <td>${formattedSANs}</td>
            </tr>
          </table>
        `;
        output.innerHTML = html;
      } catch (e) {
        output.innerHTML = '<p style="color:red;">Error decoding certificate: ' + e + '</p>';
      }
    }
  </script>

</body>
</html>